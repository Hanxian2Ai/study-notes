## 进程管理

### 什么是进程？

> 进程是**程序**的**一次执行**
>
> 进程是程序在一个**数据集合**上运行的过程
>
> 进程是系统进行**资源分配和调度**的一个**独立**单位 

> 结构
>
> - 控制块（PCB Process Control Block）唯一标识 os根据PCB进行创建和撤销的，存储了状态，CPU暂存器、程序计数器、输入输出关键数据等
> - 数据段 存放原始数据、中间数据
> - 程序段 指的是编译好的指令，存放在文本区域，可被多个进程共享

> 特征
>
> 动态性、并发性、独立性、异步性

> 进程与**线程**
>
> - 什么是线程
>   - Thread 进程的轻量级进程，一系列指令的集合
>   - 是一条执行路径，不能单独存在，必须包含再进程中
>   - 线程是OS中运算调度的最小单位
>
> - 为什么引入线程
>
>   - 提高OS的并发性（无需操作系统资源的分配）
>
> - 为什么引入纤程
>
>   - 无需操作系统的调度，进行线程上下文的切换，也需要保存保存调用栈，但是由于是应用层面上的，只需要占用几k、几十k的内存
>
> - 线程的熟悉
>
>   - 轻型实体
>   - **独立调度和分派的基本单位**
>   - 可并发执行
>   - **共享进程资源**
>
> - 区别
>
>   - 调度
>   - **拥有资源**
>   - **并发性**
>   - 系统开销
>   - 地址空间和其他资源
>   - 通信
>
> - **重点： 线程相对于进程大大降低了创建、撤销和切换可执行实体的成本和难度**
>
> - **线程的实现方式**
>
>   - 用户级线程
>
>   - 内核级线程
>
>     用户级方式：看不到用户线程，给时间片是按照进程给的，所以线程再多都没什么用，切换比较快，全部在用户空间实现
>
>     内核级方式：线程控制块在内核，数据段和程序段在内核，切换线程，需要从用户空间到内核空间，发生系统调用运行速度快，切换效率变低了
>
>     组合方式：多对多的关系，协程的实现

### 进程是怎么运行的？

进程的状态

> 三种基本状态
>
> - 就绪 Ready
>
> - 执行 Running
>
> - 阻塞 Blocked
>
> 创建和终止状态
>
> - 创建 New
> - 终止 Terminated  

进程的控制

> 创建、撤销、挂起、阻塞、唤醒、切换。OS通过原语进行现程控制
>
> 原语就是由若干指令组成，完成特点的功能，是一种原子操作
>
> 特点：
>
> - 不会被中断
> - 在内核态执行，常驻内存
> - 内核三大支撑功能之一：中断处理、时钟管理、原语操作
>
> 创建原语、阻塞原语、唤醒原语、撤销原语
>
> 进程控制：挂起与激活
>
> - 为了系统和用户观察分析进程
> - 目前暂不需要的进程
>
> 挂起原语 suspend 
>
> - 静止就绪：放外存，不调度
> - 静止阻塞：放外存，等待事件
>
> 激活原语 active
>
> - 活动就绪：等待调度
> - 活动阻塞：等待唤醒

进程的调度

> **处理机调度**：根据一定的**算法和原则**将处理机资源进行**重新分配**的过程
>
> - 前提：作业/进程数远远大于处理机数
> - 目的：提高资源利用率，减少处理空闲时间
> - 调度程序：满足快速响应，考虑系统平均周转时间和调度算法本身的开销
>
> **处理机调度：调度的层次**
>
> - 作业调度
>   - 后备作业调入内存
>   - 调入1次，调出1次
> - 内存调度
>   - 进程调至外存，条件合适再调入内存
>   - 内外存对换区进行进程对换
> - 进程调度
>   - 就绪队列选取进程分配给处理机
>   - 最基本的调度，频率高，一个时间片内完成
>
> **调度的方式**
>
> - 抢占式调度
>   - 立刻暂停，分配给别人
>   - 原则：优先权、时间片原则、短进程优先
> - 非抢占式调度
>   - 若有进程请求执行
>   - 等待直到当前进程完成或阻塞
>   - 缺点：适合批处理系统，不适合分时/实时系统
>
> **处理机调度：调度过程**
>
> 1. 保存镜像：记录进程现场信息
> 2. 调度算法：分配处理机的原则
> 3. 进程切换：分配处理给其他进程
> 4. 处理机回收：从进程收回处理机
>    - 检查是否可以上下文切换
>    - 保存上下文，包括程序技术器和寄存器
>    - 更新PCB信息
>    - PCB移入对应队列
>
> **调度算法指标**
>
> ​	**CPU利用率** 忙碌时间:总时间
>
> ​	**系统吞吐量** 完成作业数:总时间
>
> ​	周转时间 作业完成时间-提交时间
>
> ​	等待时间 作业等待处理机调度时间
>
> ​	响应时间 提交请求到首次响应间隔
>
> **调度算法**
>
> - 先来先服务
>
> - 短作业优先
>
> - 高响应比优先调度
>
>   - 响应比（等待时间 + 服务时间）/服务时间，>=1
>   - 长作业等待越久响应比越高，更容易获得处理机
>
> - 优先级调度
>
>   - 按优先级进行调度
>   - 设置原则
>     - 静态/动态优先级
>     - 系统>用户；交互式>非交互；IO>计算型
>     - 低优先可能会产生饥饿
>
> - **时间片轮转调度**
>
>   - 按进程到达就绪队列的顺序，轮流分配一个时间片去执行，时间用完久剥夺
>   - 公平轮流
>   - 抢占式，由时钟中断确定时间到
>   - 适用场景：进程调度
>   - 优缺点
>     - 公平响应快
>     - 时间片决定因素：系统响应时间、就绪队列进程数量、系统处理能力
>     - 时间片太大，相当于FCFS；太小，处理机切换频繁，开销增大
>
> - **多级反馈队列调度**
>
>   - 设置多个按优先级排序的就绪队列，
>   - 优先级从高到低，时间片从小到大
>   - 新进程采用队列降级法
>     - 进入第一级队列，按FCFS分时间片
>     - 没有执行完，移到第二级，第三级。。。
>   - 前面队列不空，不执行后续队列进程
>   - 优缺点：
>     - 对各类型相对公平
>     - 短作业优先：短作业优先
>     - 周转时间短：周转时间短
>     - 长批处理作业用户：在前几个队列部分执行
>
>   

### 进程之间是怎么协作的？

### 如何处理死锁问题？