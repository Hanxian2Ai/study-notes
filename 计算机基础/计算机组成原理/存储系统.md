## 存储系统

#### 存储器的层次结构

- 存储器的层次结构

  > CPU可以直接操作就叫内存，不能直接操作就叫IO设备
  >
  > 高速缓冲存储器：L1-L3缓存 （SRAM）
  >
  > 主存储器：内存条 （DRAM、SDRAM）
  >
  > 辅助存储器：固定磁盘、可移动存储介质（ROM NV-RAM）

- 局部性原理

  > 虚拟内存：从逻辑上扩充内存容量的存储器系统
  >
  > 局部性原理：
  >
  > - 时间局部性和空间局部性

#### 半导体存储器

- 主存储器模型

  > CPU与主存储器的连接
  >
  > 数据总线(n位)：双向总线
  >
  > ​	存取周期：两次连续存取的最小时间间隔
  >
  > ​	存储器总线宽度 = 数据总线位数 = 存储字长
  >
  > 地址总线(k位)：
  >
  > ​	可寻址的最大范围 2的k次方×n 32位bit × 存储字长 = 4G
  >
  > 控制总线
  >
  > 存储单元：存储元，电容+MOS晶体管，8个存储元代表8个bit，即为存储单元

- RAM

  > 随机读取存储器，可随机读写，断电易失
  >
  > 静态RAM：以触发器存储二进制位（6个mos管）：高速缓存和寄存器
  >
  > 动态RAM：一个/三个MOS管和一个电容存储二进制位；刷新操作，给电容补电
  >
  > - 刷新操作：2ms内安排全部刷新，给电容充电
  > - 分散刷新：每次读完就刷新
  > - 异步刷新：每间隔一段时间刷新一行
  >
  > ![image-20231011174340583](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20231011174340583.png)
  >
  > 非易失性(non-volatile)RAM：采用CMOS管构成低功耗SRAM存储单元，使用锂电池作为后备电源

- ROM（Read-Only Memory）

  > 只读存储器，可随机读
  >
  > 可擦除可编程存储器（EPROM）：紫外线擦除：光盘；电擦除：固态硬盘、闪速存储器

### 高速缓冲存储器Cache

- 基本概念

  介于CPU和主存之间，缓解二者速度矛盾

  局部性原理：时间、空间局部性

  访问顺序：CPU->Cache->主存

  - Cache中存放部分数据的拷贝

  - 缓存行/缓存行：与主存传送数据的基本单位（Byte）64个字节

  缓存命中率：85%+

  - Cache大小
  - Cache组织形式
  - 程序特性

- Cache的组织结构

  - Cache存储体

    存放从主存调入的数据

    主存按照1KB进行分页，再把这1KB的分页，分成16份，叫做字块，一份就是64字节

  - 地址转换机构

    实现主存地址到缓存地址的转换

    目录表：主存块地址、缓存块地址、有效位

  - 替换机构

    按照一定策略进行数据块替换

- Cache与主存的映像

  - 全相连映像：空位置随意放

    优点：命中率比较高，利用率比较高

    缺点：每次访问都要与全部内容比较，速度低，成本高，应用少（将主存地址无符号右移6位得到块号）

  - 直接映像：主存分区，对号入座

    主存子块只能映像到Cache特定的块中

    将主存空间按Cache大小分区

    优点：数据访问时，只需检查区号是否相等即可

    缺点：替换操作频繁，命中率比较低

  - 组相连映像：先分区再分组，组内随意放

    将主存空间按Cache大小分区

    每个区和Cache按同样大小划分为组

    存入Cache的相同组号中，组内随意

    组间直接映射，组内全相连映像

    优点：块冲突概率低，块利用率大幅提高

    缺点：实现难度和造价要比直接映像方式高

- 替换机构

  - 随机替换

  - 先进先出策略：选择最早调入Cache块替换

  - 最近最少使用（LRU，Least Recently Used）

    随机记录每个块最近一次使用次数，命中清零，未命中+1

    淘汰次数最大的块